<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Clone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --background: #ffffff;
            --foreground: #475569;
            --card: #f1f5f9;
            --card-foreground: #059669;
            --primary: #059669;
            --primary-foreground: #ffffff;
            --secondary: #f1f5f9;
            --secondary-foreground: #475569;
            --muted: #f1f5f9;
            --muted-foreground: #9ca3af;
            --accent: #10b981;
            --accent-foreground: #ffffff;
            --border: #e5e7eb;
            --input: #ffffff;
            --sidebar: #f1f5f9;
            --sidebar-foreground: #475569;
        }
        
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--background);
            color: var(--foreground);
        }
        
        .font-heading {
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
        }
        
        .bg-primary { background-color: var(--primary); }
        .text-primary { color: var(--primary); }
        .bg-accent { background-color: var(--accent); }
        .text-accent { color: var(--accent); }
        .bg-card { background-color: var(--card); }
        .text-card-foreground { color: var(--card-foreground); }
        .bg-sidebar { background-color: var(--sidebar); }
        .text-sidebar-foreground { color: var(--sidebar-foreground); }
        .border-border { border-color: var(--border); }
        .bg-input { background-color: var(--input); }
        .text-muted-foreground { color: var(--muted-foreground); }
        
        .message-bubble {
            max-width: 70%;
            word-wrap: break-word;
        }
        
        .sent {
            background-color: var(--primary);
            color: var(--primary-foreground);
            margin-left: auto;
        }
        
        .received {
            background-color: var(--input);
            color: var(--foreground);
            margin-right: auto;
        }
        
        .contact-item:hover {
            background-color: var(--card);
        }
        
        .active-contact {
            background-color: var(--accent);
            color: var(--accent-foreground);
        }
        
        .online-indicator {
            width: 12px;
            height: 12px;
            background-color: var(--accent);
            border-radius: 50%;
            position: absolute;
            bottom: 2px;
            right: 2px;
            border: 2px solid white;
        }
        
        .message-status {
            font-size: 12px;
            color: var(--muted-foreground);
        }
        
        .read-receipt {
            color: var(--accent);
        }
        
        .typing-indicator {
            display: none;
            color: var(--muted-foreground);
            font-style: italic;
            padding: 8px 16px;
        }
        
        .typing-dots {
            display: inline-block;
            animation: typing 1.5s infinite;
        }
        
        @keyframes typing {
            0%, 60%, 100% { opacity: 0; }
            30% { opacity: 1; }
        }
    </style>
</head>
<body class="h-screen overflow-hidden">
    <!-- Authentication Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 w-full max-w-md mx-4">
            <div class="text-center mb-6">
                <h1 class="font-heading text-3xl text-primary mb-2">WhatsApp Clone</h1>
                <p class="text-muted-foreground">Connect with friends and family</p>
            </div>
            
            <!-- Login Form -->
            <div id="loginForm">
                <h2 class="text-xl font-semibold mb-4">Sign In</h2>
                <form id="loginFormElement" class="space-y-4">
                    <div>
                        <input type="text" id="loginUsername" placeholder="Username" 
                               class="w-full p-3 border border-border rounded-lg bg-input focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <input type="password" id="loginPassword" placeholder="Password" 
                               class="w-full p-3 border border-border rounded-lg bg-input focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <button type="submit" class="w-full bg-primary text-white p-3 rounded-lg hover:opacity-90 transition-opacity">
                        Sign In
                    </button>
                </form>
                <p class="text-center mt-4 text-muted-foreground">
                    Don't have an account? 
                    <button id="showSignup" class="text-primary hover:underline">Sign up</button>
                </p>
            </div>
            
            <!-- Signup Form -->
            <div id="signupForm" class="hidden">
                <h2 class="text-xl font-semibold mb-4">Sign Up</h2>
                <form id="signupFormElement" class="space-y-4">
                    <div>
                        <input type="text" id="signupUsername" placeholder="Username" 
                               class="w-full p-3 border border-border rounded-lg bg-input focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <input type="email" id="signupEmail" placeholder="Email" 
                               class="w-full p-3 border border-border rounded-lg bg-input focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <div>
                        <input type="password" id="signupPassword" placeholder="Password" 
                               class="w-full p-3 border border-border rounded-lg bg-input focus:outline-none focus:ring-2 focus:ring-primary">
                    </div>
                    <button type="submit" class="w-full bg-primary text-white p-3 rounded-lg hover:opacity-90 transition-opacity">
                        Sign Up
                    </button>
                </form>
                <p class="text-center mt-4 text-muted-foreground">
                    Already have an account? 
                    <button id="showLogin" class="text-primary hover:underline">Sign in</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Main Chat Interface -->
    <div id="chatInterface" class="hidden h-full flex">
        <!-- Sidebar -->
        <div class="w-full md:w-1/3 bg-sidebar border-r border-border flex flex-col">
            <!-- Header -->
            <div class="p-4 border-b border-border bg-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white font-semibold">
                            <span id="userInitial">U</span>
                        </div>
                        <div>
                            <h3 class="font-semibold" id="currentUser">User</h3>
                            <p class="text-sm text-muted-foreground">Online</p>
                        </div>
                    </div>
                    <button id="logoutBtn" class="text-muted-foreground hover:text-foreground">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Search -->
            <div class="p-4">
                <input type="text" placeholder="Search contacts..." 
                       class="w-full p-2 border border-border rounded-lg bg-input focus:outline-none focus:ring-2 focus:ring-primary">
            </div>
            
            <!-- Contacts List -->
            <div class="flex-1 overflow-y-auto">
                <div id="contactsList">
                    <!-- Contacts will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Chat Area -->
        <div class="flex-1 flex flex-col">
            <!-- Chat Header -->
            <div id="chatHeader" class="p-4 border-b border-border bg-white flex items-center space-x-3">
                <div class="w-10 h-10 bg-accent rounded-full flex items-center justify-center text-white font-semibold">
                    <span id="contactInitial">?</span>
                </div>
                <div class="flex-1">
                    <h3 class="font-semibold" id="contactName">Select a contact</h3>
                    <p class="text-sm text-muted-foreground" id="contactStatus">Click on a contact to start chatting</p>
                </div>
            </div>
            
            <!-- Messages Area -->
            <div class="flex-1 overflow-y-auto p-4 bg-gray-50" id="messagesArea">
                <div id="messagesList" class="space-y-4">
                    <!-- Messages will be populated here -->
                </div>
                <div id="typingIndicator" class="typing-indicator">
                    <span class="typing-dots">Someone is typing...</span>
                </div>
            </div>
            
            <!-- Message Input -->
            <div class="p-4 border-t border-border bg-white">
                <div class="flex items-center space-x-3">
                    <input type="text" id="messageInput" placeholder="Type a message..." 
                           class="flex-1 p-3 border border-border rounded-full bg-input focus:outline-none focus:ring-2 focus:ring-primary"
                           disabled>
                    <button id="sendBtn" class="bg-primary text-white p-3 rounded-full hover:opacity-90 transition-opacity disabled:opacity-50" disabled>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // App State
        let currentUser = null;
        let selectedContact = null;
        let users = JSON.parse(localStorage.getItem('whatsapp_users') || '[]');
        let messages = JSON.parse(localStorage.getItem('whatsapp_messages') || '{}');
        
        // Default contacts for demo
        const defaultContacts = [
            { id: 'alice', username: 'Alice Johnson', email: 'alice@example.com', online: true },
            { id: 'bob', username: 'Bob Smith', email: 'bob@example.com', online: false },
            { id: 'charlie', username: 'Charlie Brown', email: 'charlie@example.com', online: true },
            { id: 'diana', username: 'Diana Prince', email: 'diana@example.com', online: true },
            { id: 'eve', username: 'Eve Wilson', email: 'eve@example.com', online: false }
        ];
        
        // Initialize default contacts if none exist
        if (users.length === 0) {
            users = defaultContacts;
            localStorage.setItem('whatsapp_users', JSON.stringify(users));
        }
        
        // DOM Elements
        const authModal = document.getElementById('authModal');
        const chatInterface = document.getElementById('chatInterface');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const showSignupBtn = document.getElementById('showSignup');
        const showLoginBtn = document.getElementById('showLogin');
        const loginFormElement = document.getElementById('loginFormElement');
        const signupFormElement = document.getElementById('signupFormElement');
        const logoutBtn = document.getElementById('logoutBtn');
        const contactsList = document.getElementById('contactsList');
        const messagesList = document.getElementById('messagesList');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const currentUserElement = document.getElementById('currentUser');
        const userInitialElement = document.getElementById('userInitial');
        const contactNameElement = document.getElementById('contactName');
        const contactInitialElement = document.getElementById('contactInitial');
        const contactStatusElement = document.getElementById('contactStatus');
        const typingIndicator = document.getElementById('typingIndicator');
        
        // Authentication Functions
        function showSignup() {
            loginForm.classList.add('hidden');
            signupForm.classList.remove('hidden');
        }
        
        function showLogin() {
            signupForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
        }
        
        function login(username, password) {
            const user = users.find(u => u.username === username);
            if (user) {
                currentUser = user;
                localStorage.setItem('whatsapp_current_user', JSON.stringify(user));
                showChatInterface();
                return true;
            }
            return false;
        }
        
        function signup(username, email, password) {
            if (users.find(u => u.username === username || u.email === email)) {
                return false; // User already exists
            }
            
            const newUser = {
                id: Date.now().toString(),
                username,
                email,
                online: true
            };
            
            users.push(newUser);
            localStorage.setItem('whatsapp_users', JSON.stringify(users));
            
            currentUser = newUser;
            localStorage.setItem('whatsapp_current_user', JSON.stringify(newUser));
            showChatInterface();
            return true;
        }
        
        function logout() {
            currentUser = null;
            selectedContact = null;
            localStorage.removeItem('whatsapp_current_user');
            authModal.classList.remove('hidden');
            chatInterface.classList.add('hidden');
        }
        
        function showChatInterface() {
            authModal.classList.add('hidden');
            chatInterface.classList.remove('hidden');
            currentUserElement.textContent = currentUser.username;
            userInitialElement.textContent = currentUser.username.charAt(0).toUpperCase();
            loadContacts();
        }
        
        // Contact Functions
        function loadContacts() {
            const otherUsers = users.filter(u => u.id !== currentUser.id);
            contactsList.innerHTML = '';
            
            otherUsers.forEach(user => {
                const contactElement = document.createElement('div');
                contactElement.className = 'contact-item p-4 cursor-pointer border-b border-border flex items-center space-x-3';
                contactElement.onclick = () => selectContact(user);
                
                const lastMessage = getLastMessage(user.id);
                const unreadCount = getUnreadCount(user.id);
                
                contactElement.innerHTML = `
                    <div class="relative">
                        <div class="w-12 h-12 bg-accent rounded-full flex items-center justify-center text-white font-semibold">
                            ${user.username.charAt(0).toUpperCase()}
                        </div>
                        ${user.online ? '<div class="online-indicator"></div>' : ''}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-center">
                            <h4 class="font-semibold truncate">${user.username}</h4>
                            <span class="text-xs text-muted-foreground">${lastMessage ? formatTime(lastMessage.timestamp) : ''}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <p class="text-sm text-muted-foreground truncate">${lastMessage ? lastMessage.text : 'No messages yet'}</p>
                            ${unreadCount > 0 ? `<span class="bg-accent text-white text-xs rounded-full px-2 py-1 min-w-[20px] text-center">${unreadCount}</span>` : ''}
                        </div>
                    </div>
                `;
                
                contactsList.appendChild(contactElement);
            });
        }
        
        function selectContact(contact) {
            selectedContact = contact;
            
            // Update active contact styling
            document.querySelectorAll('.contact-item').forEach(item => {
                item.classList.remove('active-contact');
            });
            event.currentTarget.classList.add('active-contact');
            
            // Update chat header
            contactNameElement.textContent = contact.username;
            contactInitialElement.textContent = contact.username.charAt(0).toUpperCase();
            contactStatusElement.textContent = contact.online ? 'Online' : 'Last seen recently';
            
            // Enable message input
            messageInput.disabled = false;
            sendBtn.disabled = false;
            messageInput.focus();
            
            // Load messages
            loadMessages();
            
            // Mark messages as read
            markMessagesAsRead(contact.id);
        }
        
        // Message Functions
        function loadMessages() {
            if (!selectedContact) return;
            
            const chatKey = getChatKey(currentUser.id, selectedContact.id);
            const chatMessages = messages[chatKey] || [];
            
            messagesList.innerHTML = '';
            
            chatMessages.forEach(message => {
                const messageElement = createMessageElement(message);
                messagesList.appendChild(messageElement);
            });
            
            scrollToBottom();
        }
        
        function createMessageElement(message) {
            const messageDiv = document.createElement('div');
            const isSent = message.senderId === currentUser.id;
            
            messageDiv.className = `message-bubble p-3 rounded-lg ${isSent ? 'sent' : 'received'}`;
            
            const statusIcon = message.read ? '✓✓' : '✓';
            const statusClass = message.read ? 'read-receipt' : '';
            
            messageDiv.innerHTML = `
                <p class="mb-1">${message.text}</p>
                <div class="flex justify-between items-center">
                    <span class="text-xs opacity-70">${formatTime(message.timestamp)}</span>
                    ${isSent ? `<span class="message-status ${statusClass}">${statusIcon}</span>` : ''}
                </div>
            `;
            
            return messageDiv;
        }
        
        function sendMessage() {
            if (!selectedContact || !messageInput.value.trim()) return;
            
            const message = {
                id: Date.now().toString(),
                senderId: currentUser.id,
                receiverId: selectedContact.id,
                text: messageInput.value.trim(),
                timestamp: new Date().toISOString(),
                read: false
            };
            
            const chatKey = getChatKey(currentUser.id, selectedContact.id);
            if (!messages[chatKey]) {
                messages[chatKey] = [];
            }
            
            messages[chatKey].push(message);
            localStorage.setItem('whatsapp_messages', JSON.stringify(messages));
            
            // Add message to UI
            const messageElement = createMessageElement(message);
            messagesList.appendChild(messageElement);
            
            // Clear input and scroll
            messageInput.value = '';
            scrollToBottom();
            
            // Update contacts list
            loadContacts();
            
            // Simulate typing indicator and auto-reply
            simulateTyping();
        }
        
        function simulateTyping() {
            if (!selectedContact) return;
            
            typingIndicator.style.display = 'block';
            scrollToBottom();
            
            setTimeout(() => {
                typingIndicator.style.display = 'none';
                
                // Auto-reply
                const replies = [
                    "Thanks for your message!",
                    "I'll get back to you soon.",
                    "That sounds great!",
                    "Sure, let me think about it.",
                    "Absolutely!",
                    "I agree with you.",
                    "That's interesting!",
                    "Let me check and get back to you."
                ];
                
                const randomReply = replies[Math.floor(Math.random() * replies.length)];
                
                const replyMessage = {
                    id: Date.now().toString(),
                    senderId: selectedContact.id,
                    receiverId: currentUser.id,
                    text: randomReply,
                    timestamp: new Date().toISOString(),
                    read: false
                };
                
                const chatKey = getChatKey(currentUser.id, selectedContact.id);
                messages[chatKey].push(replyMessage);
                localStorage.setItem('whatsapp_messages', JSON.stringify(messages));
                
                const messageElement = createMessageElement(replyMessage);
                messagesList.appendChild(messageElement);
                scrollToBottom();
                
                // Update contacts list
                loadContacts();
            }, 2000);
        }
        
        // Utility Functions
        function getChatKey(userId1, userId2) {
            return [userId1, userId2].sort().join('_');
        }
        
        function getLastMessage(contactId) {
            const chatKey = getChatKey(currentUser.id, contactId);
            const chatMessages = messages[chatKey] || [];
            return chatMessages[chatMessages.length - 1];
        }
        
        function getUnreadCount(contactId) {
            const chatKey = getChatKey(currentUser.id, contactId);
            const chatMessages = messages[chatKey] || [];
            return chatMessages.filter(m => m.senderId === contactId && !m.read).length;
        }
        
        function markMessagesAsRead(contactId) {
            const chatKey = getChatKey(currentUser.id, contactId);
            const chatMessages = messages[chatKey] || [];
            
            chatMessages.forEach(message => {
                if (message.receiverId === currentUser.id) {
                    message.read = true;
                }
            });
            
            localStorage.setItem('whatsapp_messages', JSON.stringify(messages));
            loadContacts();
        }
        
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffInHours = (now - date) / (1000 * 60 * 60);
            
            if (diffInHours < 24) {
                return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            } else {
                return date.toLocaleDateString();
            }
        }
        
        function scrollToBottom() {
            const messagesArea = document.getElementById('messagesArea');
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }
        
        // Event Listeners
        showSignupBtn.addEventListener('click', showSignup);
        showLoginBtn.addEventListener('click', showLogin);
        logoutBtn.addEventListener('click', logout);
        
        loginFormElement.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (login(username, password)) {
                // Success
            } else {
                alert('Invalid credentials. Try: alice, bob, charlie, diana, or eve');
            }
        });
        
        signupFormElement.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('signupUsername').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            
            if (signup(username, email, password)) {
                // Success
            } else {
                alert('Username or email already exists');
            }
        });
        
        sendBtn.addEventListener('click', sendMessage);
        
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Initialize App
        function initApp() {
            const savedUser = localStorage.getItem('whatsapp_current_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showChatInterface();
            }
        }
        
        initApp();
    </script>
</body>
</html>
